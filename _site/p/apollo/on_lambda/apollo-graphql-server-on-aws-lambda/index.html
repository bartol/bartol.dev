<p>There are number of things why I really like working with GraphQL. I also enjoy writing Lambda Functions to do simple things without needing to manage full-blown server. Why not merge both? Apollo is awesome tool that will make it super easy! To start, install Apollo Server and GraphQL.</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token function">yarn</span> <span class="token function">add</span> apollo-server-lambda graphql</span></code></pre>
<p>This article assumes that you already have <a href="https://serverless.com/">serverless framework</a> up and running, so I'll show just functions section.</p>
<pre class="language-yaml"><code class="language-yaml"><span class="highlight-line"><span class="token key atrule">functions</span><span class="token punctuation">:</span></span><br><span class="highlight-line">  <span class="token key atrule">graphql</span><span class="token punctuation">:</span></span><br><span class="highlight-line">    <span class="token key atrule">handler</span><span class="token punctuation">:</span> handler.graphql</span><br><span class="highlight-line">    <span class="token key atrule">events</span><span class="token punctuation">:</span></span><br><span class="highlight-line">      <span class="token punctuation">-</span> <span class="token key atrule">http</span><span class="token punctuation">:</span></span><br><span class="highlight-line">          <span class="token key atrule">path</span><span class="token punctuation">:</span> graphql</span><br><span class="highlight-line">          <span class="token key atrule">method</span><span class="token punctuation">:</span> post</span><br><span class="highlight-line">          <span class="token key atrule">cors</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span><br><span class="highlight-line">      <span class="token punctuation">-</span> <span class="token key atrule">http</span><span class="token punctuation">:</span></span><br><span class="highlight-line">          <span class="token key atrule">path</span><span class="token punctuation">:</span> graphql</span><br><span class="highlight-line">          <span class="token key atrule">method</span><span class="token punctuation">:</span> get</span><br><span class="highlight-line">          <span class="token key atrule">cors</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span></code></pre>
<p>After that we will create <code>handler.js</code> file in which server will live and import needed packages.</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ApolloServer<span class="token punctuation">,</span> gql <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'apollo-server-lambda'</span></span></code></pre>
<p>Now comes <em>the GraphQL part</em>. Let's create type definitions for API.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> typeDefs <span class="token operator">=</span> gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"><br><span class="highlight-line">  type Query {</span><br><span class="highlight-line">    message: String!</span><br><span class="highlight-line">  }</span><br></span><span class="token template-punctuation string">`</span></span></code></pre>
<p>Next, create resolvers. Here you can call functions to get data from database or similar. For testing purposes I'll just return string.</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">const</span> resolvers <span class="token operator">=</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  Query<span class="token punctuation">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token function-variable function">message</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">'Your Apollo Server is working.'</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>And finally, you must wire up type definitions and resolvers with Apollo and export it.</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span><br><span class="highlight-line">  typeDefs<span class="token punctuation">,</span></span><br><span class="highlight-line">  resolvers<span class="token punctuation">,</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">exports<span class="token punctuation">.</span>graphql <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">createHandler</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span><br><span class="highlight-line">  cors<span class="token punctuation">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    origin<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    credentials<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span></code></pre>
<p>There are still few things left to do! Run <code>sls deploy</code> to deploy Apollo Server. After Lambda is successfully uploaded to AWS API Gateway you can visit <a href="https://YOUR-API-ENDPOINT/graphql">https://YOUR-API-ENDPOINT/graphql</a> to try API in GraphQL Playground!</p>
