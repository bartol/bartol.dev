<p>When I was working on v2 of this website (BTW now working on v3), about  2 months ago, I have encountered this seemingly easy feature to implement. Select one or more tags to filter results. And oh, boy it was harder than expected. After searching, I've found this mysterious function that gets the job done. It's like black box. I don't understand anything in it. But it works.</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">const</span> <span class="token function-variable function">filterArray</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> filters</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">const</span> filterKeys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>filters<span class="token punctuation">)</span></span><br><span class="highlight-line">  <span class="token keyword">return</span> array<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token comment">// validates all filter criteria</span></span><br><span class="highlight-line">    <span class="token keyword">return</span> filterKeys<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">      <span class="token comment">// ignores non-function predicates</span></span><br><span class="highlight-line">      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> filters<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span></span><br><span class="highlight-line">      <span class="token keyword">return</span> filters<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>There is no better way to show it how it works than real example. That is also partially because I don't know how to explain it. Here is array that contains selected tags and array that contains array of articles that each have array of tags. It will filter results array so only articles with one or more of selected tags are returned.</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">const</span> listOfTags <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'typescript'</span><span class="token punctuation">,</span> <span class="token string">'go'</span><span class="token punctuation">]</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token punctuation">[</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    frontmatter<span class="token punctuation">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">      tags<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'deno'</span><span class="token punctuation">,</span> <span class="token string">'typescript'</span><span class="token punctuation">]</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    frontmatter<span class="token punctuation">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">      tags<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'javascript'</span><span class="token punctuation">]</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br><span class="highlight-line">  <span class="token comment">// ...</span></span><br><span class="highlight-line"><span class="token punctuation">]</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">const</span> filteredArray <span class="token operator">=</span> <span class="token function">filterArray</span><span class="token punctuation">(</span>results<span class="token punctuation">,</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token function-variable function">frontmatter</span><span class="token punctuation">:</span> <span class="token parameter">frontmatter</span> <span class="token operator">=></span> frontmatter<span class="token punctuation">.</span>tags<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=></span> listOfTags<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span></code></pre>
<p>Sorry if this was confusing, but it's quite complex and I don't fully understand it, yet. I'll probably revisit this piece in the future and explain it better.</p>
